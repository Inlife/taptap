<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
        <title>game-test</title>

        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
        <!-- Optional theme -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">

        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
            <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
        <style type="text/css">
            body {
                text-align: center;    
            }
            table {
                margin: 50px auto;
            }
            td {
                width: 75px;
                height: 75px;
                background-color: #777;
                border: 1px dotted #fff;
            }

            .value_0 {
                background-color: #55d;
            }

            .value_1 {
                background-color: #d55;
            }
        </style>
    </head>
    <body>
        <h1>Hello, world!</h1>

        <div id="container"></div>

        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <!-- Latest compiled and minified JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
        <!-- Include all compiled plugins (below), or include individual files as needed -->
        <script type="text/javascript">
            'use strict';

            var size = 6;

            // Returns a random integer between min (included) and max (included)
            // Using Math.round() will give you a non-uniform distribution!
            function getRandomIntInclusive(min, max) {
                return Math.floor(Math.random() * (max - min + 1)) + min;
            }

            var generateTable = function(id, size, cb) {
                var field = [], list = {};

                $(id).append( $("<table></table>") );

                for (var i = 0, c = 0; i < size; i++) {
                    field[i] = [];

                    $(id + " table").append( $("<tr class='row row_" + i + "'></tr>") );

                    for (var j = 0; j < size; j++, c++) {
                        field[i][j] = {
                            id: "#field_" + (c),
                            value: (Math.random() > 0.5) ? 1 : 0,

                            subid: [],

                            setValue: function(val) {
                                $(this.id).removeClass('value_' + this.value).addClass('value_' + val);
                                this.value = val;
                            },

                            toggleSubids: function() {
                                for (var i = this.subid.length - 1; i >= 0; i--) {
                                    list[this.subid[i]].toggle();
                                };
                            },

                            toggle: function() {
                                this.setValue( (this.value == 1) ? 0 : 1 );
                            }
                        };
                        list[field[i][j].id] = field[i][j];
                        
                        $(id + " table .row_" + i).append( $("<td id='" + field[i][j].id.replace('#', '') + "' class='cell cell_" + j + "'></td>") );
                        $(field[i][j].id).addClass("value_" + field[i][j].value);
                        $(field[i][j].id).click(function() {
                            var id = $(this).attr('id');
                            var cell = list['#' + id];
                            
                            cell.toggle();
                            cell.toggleSubids();

                            cb( cell );
                        });
                    }
                }

                var map = {};
                var free = size * size - 1;
                for (var id in list) {
                    map[id] = false;
                }

                for (var id in list) {
                    var count = getRandomIntInclusive(0, 2);

                    while (count > 0) {
                        var found = false;

                        while (free > 0 && !found) {
                            var subid = '#field_' + getRandomIntInclusive(0, size * size - 1);

                            if (!map[subid] && id !== subid) {
                                map[subid] = true;
                                found = true;
                                free--;
                                list[id].subid.push(subid);
                            }
                        }

                        count--;
                    }
                }

                return [field, map];
            }

            var field = generateTable("#container", size, function(cell) {
                console.log(cell);
            });


        </script>
    </body>
</html>